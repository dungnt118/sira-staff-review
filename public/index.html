<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>SIRA - Mini App ÄÃ¡nh GiÃ¡</title>
</head>

<body>
  <h2>Mini App ÄÃ¡nh GiÃ¡</h2>
  <button id="login">ÄÄƒng nháº­p Google</button>
  <pre id="out"></pre>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    // ğŸ”¥ Láº¤Y CONFIG á»: Firebase Console â†’ Project settings â†’ General â†’ Your apps (Web)
    const firebaseConfig = {
      apiKey: "AIzaSyDmkaE51CRnu4AJPo6uAc9Web19sZ-CeHU",
      authDomain: "tmas-5f48e.firebaseapp.com",
      projectId: "tmas-5f48e",
      storageBucket: "tmas-5f48e.firebasestorage.app",
      messagingSenderId: "256219032535",
      appId: "1:256219032535:web:982400f879da9b43cd3992",
      measurementId: "G-MXJB7G7KYT"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const out = document.getElementById("out");
    const btn = document.getElementById("login");

    btn.onclick = async () => {
      try {
        out.textContent = "Äang login...";
        const provider = new GoogleAuthProvider();
        
        // ThÃªm scope vÃ  parameters Ä‘á»ƒ trÃ¡nh lá»—i
        provider.addScope('email');
        provider.addScope('profile');
        provider.setCustomParameters({
          'prompt': 'select_account'
        });

        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const idToken = await user.getIdToken();

        out.textContent = `âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!
        
ğŸ“§ Email: ${user.email}
ğŸ‘¤ TÃªn: ${user.displayName}
ğŸ†” UID: ${user.uid}
ğŸ”‘ Token: ${idToken.substring(0, 50)}...

âš ï¸ LÆ°u Ã½: Firebase Functions cáº§n Blaze plan Ä‘á»ƒ hoáº¡t Ä‘á»™ng.
Vui lÃ²ng upgrade project táº¡i: 
https://console.firebase.google.com/project/tmas-5f48e/usage/details`;

      } catch (error) {
        console.error("âŒ Lá»—i chi tiáº¿t:", error);
        
        // Xá»­ lÃ½ cÃ¡c loáº¡i lá»—i cá»¥ thá»ƒ
        if (error.code === 'auth/popup-closed-by-user') {
          out.textContent = "âŒ Báº¡n Ä‘Ã£ Ä‘Ã³ng popup Ä‘Äƒng nháº­p. Vui lÃ²ng thá»­ láº¡i!";
        } else if (error.code === 'auth/popup-blocked') {
          out.textContent = "âŒ Popup bá»‹ cháº·n bá»Ÿi trÃ¬nh duyá»‡t. Vui lÃ²ng cho phÃ©p popup vÃ  thá»­ láº¡i!";
        } else if (error.code === 'auth/unauthorized-domain') {
          out.textContent = "âŒ Domain chÆ°a Ä‘Æ°á»£c á»§y quyá»n. Lá»—i cáº¥u hÃ¬nh OAuth.";
        } else if (error.code === 'auth/invalid-api-key') {
          out.textContent = "âŒ API Key khÃ´ng há»£p lá»‡.";
        } else if (error.message && error.message.includes('redirect_uri_mismatch')) {
          out.textContent = "âŒ Lá»—i redirect_uri_mismatch. Cáº§n cáº¥u hÃ¬nh láº¡i Google Cloud Console.";
        } else {
          out.textContent = `âŒ Lá»—i: ${error.code || 'unknown'}\n${error.message}`;
        }
      }
    };
  </script>
</body>

</html>